In this chapter a survey of pervasive healthcare applications is presented. In order to gain a greater understanding of the building blocks of a typical \acf{IoT} system, a reference model for \acs{IoT} systems is also discussed. With this knowledge, a comparative analysis of similar works in the literature is presented, identifying the strengths and weaknesses of each approach. The chapter is concluded by stating the contributions that this work proposes to achieve.

\section{Internet of Things}

\subsection{Fundamentals of \acs{IoT}}

% Por ser tão central ao trabalho, colocar a definição dentro de uma caixa para ficar mais realçada pode fazer sentido. Avalia isso.

\acl{IoT} (or \acs{IoT}) is an emerging communication paradigm, often hailed as the driver of the Fourth Industrial Revolution \cite{Aceto2020}. \bigskip

The definition of this concept has evolved over time with the development of other technologies such as data analytics, embedded systems, sensors, etc. Fundamentally, it can be described as the following \cite{Baker2017}: \bigskip

\begin{tcolorbox}[colback=blue!5!white,colframe=blue!75!black]
    \acs{IoT} addresses the development of networks of smart devices that exchange and process information through Machine-to-Machine (M2M) communications, usually based on the \acf{IP}.
\end{tcolorbox}

This technology enables ubiquitous systems to gather remarkable amounts of information regarding the surrounding environment, which can later be turned into insight through the usage of data fusion and data analytics tools, like Machine Learning. \bigskip

In the specific context of healthcare, this technology can provide many benefits as it enables remote and continuous health monitoring \cite{Doukas2012, Wu2020, Fan2014}. It allows non-critical patients to be monitored from the comfort of their own houses, rather than in hospitals or clinics, reducing the strain on scarce hospital resources such as health professionals or beds. This is particularly beneficial to those who live in rural areas, with limited access to healthcare services. It enables elderly people and those with chronic diseases to have greater control over their own health, thus allowing them to live more independently. Moreover, with the automatization of medical procedures, these systems can make healthcare infrastructures more efficient and therefore lower the costs of healthcare \cite{Catarinucci2015, Adame2018}. Particularly, in the realm of clinical research, by analyzing the data collected by these ubiquitous systems, it may be possible to find new relationships between certain pathologies and different physiological signals, such as variations in body temperature or heart rate \cite{Choi2016}. These correlations, commonly referred to as biomarkers, can be used by these systems to assist clinical decisions, enabling novel predictive, prognostic, and diagnostic processes in healthcare.

\section{A Reference Model for Pervasive Healthcare Applications}

Reference models provide an abstract framework for designing systems and a set of commonly recommended practices for the application domain. It serves as a starting point in the design process, enabling the comprehension of complex systems by breaking them down into simple and distinct functional layers, while also defining some common terminology used in its domain. \bigskip

In 2014, the \acs{IoT} World Forum (IoTWF) architectural committee published an \acs{IoT} architectural reference model, composed by seven layers as shown in Figure \ref{fig:iotwf-referencemodel}. This model \cite{Cisco2014} provides a simple and clean functional view into the different components of an \acs{IoT} system, without narrowing the scope or locality of its components. While this model can be used to generically develop \acs{IoT} systems for any industry (\textit{e.g.} from agriculture to smart cities), in the context of the dissertation our focus will remain on pervasive healthcare applications and related technologies. \bigskip

\begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{images/IoT_Reference_Model.pdf}
    \caption[IoT reference model published by IoTWF.]{IoT reference model published by IoTWF. Source: \cite{Cisco2014}.}
    \label{fig:iotwf-referencemodel}
\end{figure}


 %From a hardware perspective, in this work the most common approach taken by researchers is considered, using 3 distinct components: 

%\begin{itemize}
%    \item \textbf{Endpoint} or \textbf{edge} nodes (corresponding to Layer 1), which interact with the physical world, capturing data.
%    \item \textbf{Gateway} devices (Layer 3), which connect to one or multiple \textbf{edge} nodes, filtering and aggregating the data generated by these and communicating it to a central server; 
%    \item \textbf{Central} server (Layers 4-6), which is responsible for collecting, storing and analyzing the captured data in order to provide users with valuable insight;
%\end{itemize}

\subsection{Layer 1: Physical Devices and Controllers}
\label{sec:iot-model-layer1}

The first layer of the model \cite{Cisco2014} corresponds to the physical devices and controller layer. This layer houses the ``things'' in the \acl{IoT}: the endpoint devices composed of sensors and actuators that perceive and interact with the physical world. Through those interactions, the devices generate data, which is then sent across the network for analysis and storage. \bigskip

Wearable, wireless, and non-intrusive devices are viewed as one of the key components of \acs{IoT}-based healthcare systems \cite{Baker2017}. In recent years there has been remarkable progress on the development of wearable devices, driven by recent technological breakthroughs in the miniaturization of sensors and microfabrication processes \cite{Adame2018, Catarinucci2015}. These devices allow patients to be monitored while retaining their mobility, increasing the comfort of these users. The drawback of this approach lies on the restrictions imposed on the devices. Due to the nature of this technology, most of these units require a portable energy source, which implies reduced memory, computation, and connectivity capabilities in order to minimize energy consumption and maximize their lifetime. Shorter lifetimes translate into higher maintenance costs, as these devices need to be replaced more often. \bigskip

Another point to consider is the data requirements of the system, namely how much data is generated and which type of data is transmitted by each device. Some applications can include a single temperature sensor or heart rate sensor, while more complex systems can include pulse oximetry, electrocardiogram (\acs{ECG}), respiration rate sensors, etc. \cite{Wu2020}. From the literature \cite{Wu2020, Wu2019, Adame2018, MinhDang2019}, the sensors used in these devices can be classified into three distinct categories based on the signals that can be extracted from them, as shown in Table \ref{tab:layer1-sensors}:

\begin{itemize}
    \item \textbf{Physiological Sensors}: used for evaluating the patients' health condition.
    \item \textbf{Activity / Motion sensors}: used for detecting fall events, determining the patients location and the travelled distance, estimating the patients body posture, etc.
    \item \textbf{Environmental Sensors}: used for assessing environment conditions and possible hazards, \textit{e.g.} gas leaks in a patients home or an industrial workplace \cite{Wu2019}.
\end{itemize}

\renewcommand{\arraystretch}{2}
\begin{table}[H]
    \centering
    \caption[Type of sensors commonly used in pervasive healthcare applications.]{Type of sensors commonly used in pervasive healthcare applications. Adapted from \cite{MinhDang2019}.}
    \begin{tabular}{l|l}
        \textbf{Sensor Categories} & \textbf{Examples} \\ 
        \hline
        Vital Signs Monitoring & \makecell{Blood Pressure, \acs{ECG}, PPG, Body Temperature, \\ Respiratory Rate, Galvanic Skin Response, \\ Pulse Oximetry, Glucose Level Sensors} \\
        Activity Monitoring & Accelerometer, Gyroscope, Magnetometer\\
        Environmental Monitoring & Air Temperature, Barometer, Humidity, Gas Sensors \\
    \end{tabular}
    \label{tab:layer1-sensors} 
\end{table}
\renewcommand{\arraystretch}{1}

\subsection{Layer 2: Connectivity}
\label{sec:iot-model-layer2}

The second layer of the model focuses on connectivity, on linking the different components of the system, ensuring reliable and timely data transmissions. This includes all communications within the system, which can be divided into two categories: communications within the local network (\textit{e.g.} between edge nodes and the gateway devices), and communications between the edge of the local network (\textit{e.g.} gateway devices) and the central server. \bigskip

\subsubsection{Communication Protocols}

Technology is designed with particular use cases in mind, built to fulfill a certain need which other similar technologies fail to meet \cite{Cisco2014}. As such, each technology will be different, having advantages and disadvantages depending on its usage. For instance, short range wireless protocols are, by definition, limited by transmission range, but longer range protocols have in general a higher energy consumption, which may become unviable for networks with highly constrained devices. Some protocols communicate within certain frequency bands, some of which may require special licenses. Using licensed frequency bands can provide a better performance as it ensures greater reliability since the network operator grants you exclusivity of frequency spectrum within certain areas but may be too costly. \bigskip

From the literature, a set of key requirements that drive the decision of the communication protocols can be identified \cite{Baker2017, Catarinucci2015, Adame2018}:

\begin{itemize}
    \item \textbf{Energy consumption}: For networks composed of energy constrained devices, the communication protocol should be lightweight and energy efficient in order to maximize the devices' lifetime. 
    \item \textbf{Latency}: Certain applications deal with time critical events, for example the detection of health emergencies \cite{Catarinucci2015}. In these cases, any delays in the communications can cause great detriment to the patients well-being, making it crucial to minimize them.
    \item \textbf{Reliability}: Depending on the critical nature of the data that is being communicated, the network stack may need to implement processes such as error-detection, retransmission or handshakes in the communications to ensure more robust transmissions, \textit{e.g.} as implemented in TCP/IP based protocols. Generally, these features come at the cost of greater latency. Therefore, when choosing the communication protocol, a balance must be found between reliability and latency.
    \item \textbf{Security}: Security is one of the most important requirements of any system, but this is especially true for healthcare applications. Due to the sensitive nature of the information, it is crucial to secure it from malicious actors. Communication protocols must implement security mechanisms, such as encryption or data integrity verifications, that ensure the transmissions are not compromised in transit, thus denying third parties the ability to snoop or tamper the transmissions. This issue is studied in depth in \cite{Gope2016}.
    \item \textbf{Interoperability}: To ensure the interoperability of intrinsically different modules of the system it is imperative to choose protocols that are widely accepted and supported in the application domain. This also contributes to the longevity and maintenance of the system, as these will most likely remain supported for longer time periods. 
    \item \textbf{Range}: The communication protocol must ensure that the devices can communicate within the required transmission range.
    \item \textbf{Scalability}: These systems may contain an enormous amount of devices, which must be uniquely identified. The communication protocol must ensure that every device in the network is addressable, and that performance is not severely impacted by the addition of new devices.
    \item \textbf{Throughput}: The communication protocol should ensure that there is enough bandwidth to handle all communications within the designated transmission range. Even within similar technologies, this can vary wildly with transmission range \cite{10.5555/3161403}.
\end{itemize}

% IEEE 802.15.4?
Regarding communications within the local network, these generally have short transmission ranges \cite{Baker2017}. Wearable devices can be often arranged in networks, aptly designated \acf{WBAN}. The most widely adopted protocol is \acf{BLE}, a low-energy version of the classic Bluetooth protocol \cite{Doukas2012, Wu2019, Wu2020}. ZigBee and \acf{RFID} are also used in many systems in this domain, particularly in asset tracking oriented applications \cite{Fuhrer2006, Catarinucci2015, Adame2018}. Despite the absence of a universal specification for \acs{RFID}, the most widely used standard is the EPCglobal Gen2 RFID \cite{EPCglobal2006}. For the sake of simplicity, \acs{EPC/RFID} is used to designate it. \bigskip

Out of the abovementioned technologies, \acs{BLE} offers greater throughput, better security, and nearly the lowest energy consumption \cite{dementyev2013power}. Table \ref{tab:comparsion-shortrangeprotocols} shows a comparison between the different protocols.

\renewcommand{\arraystretch}{1.5}
 \begin{table}[H]
     \centering
     \caption[Overview of the most common communication protocols used within short range]{Overview of the most common communication protocols used within short range. Adapted from \cite{Baker2017}.}
     \begin{adjustbox}{width=0.9\columnwidth,center}
     \begin{tabular}{r|l|l|l}
         & \textbf{\acs{BLE}} & \textbf{EPC/\acs{RFID}}& \textbf{ZigBee}  \\ \hline
         \makecell[r]{\textbf{Band of} \\ \textbf{operation}} & 2.4 GHz & LF, HF, UHF, EHF & 2.4 GHz \\
         \textbf{Communication} & Bidirectional & \makecell{Unidirectional \\ (Bidirectional for\\ Active tags)} & Bidirectional \\
         \textbf{Topology} & \makecell{ Point-to-Point, \\ Piconet, Broadcast,\\ Mesh } & Point-to-Point & Mesh \\
         \textbf{Range} & <100 m & \makecell{<10 m, (100 m for\\ Active tags)} & 20 m \\
         \makecell[r]{\textbf{Data rate} \\ \textbf{(Typical)}} & 1Mbps & 40kbps & 250kbps \\
         \textbf{\acs{IP} Stack} & \xmark & \xmark & \cmark \\
         \makecell[r]{\textbf{Security} \\ \textbf{Features}} & \makecell{AES-128, Secure \\ pairing prior to \\ key exchange} & \xmark & \makecell{AES-128 (Optional),\\ Network key shared \\across network, \\ Optional link key to \\ secure application layer \\ communications}\\
     \end{tabular}
    \end{adjustbox}
     \label{tab:comparsion-shortrangeprotocols}
 \end{table} 
\renewcommand{\arraystretch}{1}

Regarding communications between the gateway devices and the central server, most researchers try to make use of existing infrastructure in order to facilitate the deployment of new systems. This means, that the communications between the gateway devices and the central server are often done through generic IP-based protocols such as Wi-Fi and Ethernet \cite{Adame2018, Fuhrer2006, Wu2020, Catarinucci2015}. \bigskip

\subsubsection{Application Protocols}
%\todo[inline]{To-do: Remake this intro paragraph?}

So far the underlying networking technologies that link the devices in system have been discussed. But according to the OSI Model, many of these technologies do not define the application layer: how the devices communicate with each other, how the data is formatted, if there is a hierarchy within the network, etc. When considering networks composed of constrained devices, generic web-based protocols such as \acf{HTTP} may not be adequate for \acs{IoT} applications, which prompts the development of novel lightweight messaging protocols suited for these systems. The most used application layer protocols in \acs{IoT} systems are \acf{MQTT} and \acf{CoAP}. Table \ref{tab:comparsion-applicationprotocols} overviews these widely used protocols. \bigskip

\renewcommand{\arraystretch}{1.5}
\begin{table}[H]
    \centering
    \caption[Comparison between \acs{CoAP} and \acs{MQTT} protocols.]{Comparison between \acs{CoAP} and \acs{MQTT} protocols. Adapted from \cite{10.5555/3161403}.}
    \begin{adjustbox}{width=0.9\columnwidth,center}
    \begin{tabular}{r|l|l}
        %\textbf{Features} 
        & \textbf{\acs{MQTT}}& \textbf{\acs{CoAP}}  \\ \hline
        \textbf{Transport protocol} & TCP/IP & UDP/IP \\
        \textbf{Messaging pattern} & \makecell{Publish/Subscribe \\ (asynchronous)} & \makecell{Request-Response \\ (synchronous)} \\
        \textbf{Communication model} & Many-to-many & One-to-one \\
        \textbf{Security} & SSL/TLS (Optional) & DTLS \\
        \textbf{Strengths} & \makecell{TCP and Quality of \\ Service (QoS), robust \\communications, easier \\ to implement } & \makecell{Better for lossy networks,\\ lower latency} \\
        \textbf{Weaknesses} & \makecell{Higher overhead and energy\\ consumption than \acs{CoAP}} & \makecell{Not as reliable and \\less supported than MQTT} \\
    \end{tabular}
    \end{adjustbox}
    \label{tab:comparsion-applicationprotocols}
\end{table} 
\renewcommand{\arraystretch}{1}


In \cite{Rubi2019}, the authors compare these two protocols in greater length, along with the more commonly used web-based protocol Hypertext Transfer Protocol (HTTP). They analyze the latency in the communications (from the edge devices to remote servers) and the RAM usage in the devices for each protocol and for different data sources (respiration rate, oxygen saturation and heart rate signals) and found that \acs{CoAP} presented the best overall performance. Nonetheless, all protocols had very low latencies (less than 1.5s) and low memory usage.

\paragraph{} The authors indicate that \acs{MQTT} might be more suitable when considering a certain messaging pattern — the ``Publish/Subscribe'' model. In this model, the devices that send messages, called ``publishers'', communicate them to an intermediary message broker, through a ``message topic'' (also called logical channels). The devices that wish to receive messages, called ``subscribers'', can subscribe to these topics by requesting it to the message broker. Whenever a publisher sends a message, the broker broadcasts it to all devices that have subscribed to the selected topic.  Figure \ref{fig:mqtt-message-sequence-diagram} shows a diagram of \acs{MQTT} of two clients (A and B) connecting to the \acs{MQTT} broker, and where client A transmits two messages to the topic ``client/b'' while client B subscribes to that topic. In \acs{MQTT}, a client subscribed to a topic receives a message whenever an authorized client (including itself) publishes a message on that topic.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.63\linewidth]{images/mqtt message sequence diagram.pdf}
    \caption[Diagram of a \acs{MQTT} message sequence.]{ Diagram of a \acs{MQTT} message sequence.}
    \label{fig:mqtt-message-sequence-diagram}
\end{figure}

\paragraph{} \acs{CoAP} uses a different messaging pattern, called ``Request-Response''. In this paradigm, a device sends a request to receive certain data and the second responds to this request. In \acs{CoAP}, the requests are delivered asynchronously, and so the response messages must contain a ``token'' value so that the client can identify which request resulted in this response. Figure \ref{fig:coap-message-sequence-diagram} shows a diagram of the communication, where a client makes a GET request to the \acs{CoAP} server to retrieve information. 

 % observe that the former model is event-driven while the latter is query-based \cite{Rubi2019}. % Due to the nature of how the data is generated in these types of pervasive applications, an event-driven protocol like \acs{MQTT} might be more adequate.

 \begin{figure}[H]
    \centering
    \includegraphics[width=0.45\linewidth]{images/coap message sequence diagram.pdf}
    \caption[Diagram of a \acs{CoAP} message sequence.]{ Diagram of a \acs{CoAP} message sequence.}
    \label{fig:coap-message-sequence-diagram}
\end{figure}

\subsection{Layer 3: Edge (Fog) Computing}
\label{sec:iot-model-layer3}

\acs{IoT} systems may have hundreds or even thousands of sensors generating data multiple times per second, 24 hours per day, which may require an unsustainable amount of network and computing resources. Moreover, certain applications are time critical, where delays in communication can be very detrimental. To minimize these effects, it is crucial to initiate data processing as close to the edge of the network as possible. This paradigm is usually referred to as edge computing, when the data processing occurs at the endpoint devices, or fog computing, when it happens at the edge of the local network, \textit{e.g.} in gateway devices. \bigskip

The third layer of the model defines how the system prepares the data for storage and higher level processing for the next layers. However, the endpoint or gateway devices often have limited computing capabilities, so the data processing is generally focused on preprocessing the data in real-time and handling more time critical events. More demanding and thorough data analysis is usually left to the central server. \bigskip

The different processes applied at this stage can be summarized into four distinct categories:

\begin{itemize}
    \item \textbf{Filtering}: Assessing if the data should be processed at a higher level. 
    \item \textbf{Formatting}: Reformatting data to ensure consistent formats for higher-level processing.
    \item \textbf{Cleaning}: Reducing data to minimize the impact of data on the network and higher level processing systems.
    \item \textbf{Evaluation}: Determining whether data represents a threshold or alert. This is especially relevant for applications that deal with time critical events as seen in the previous section.
\end{itemize}

% \todo[inline]{To-do: Add 2 examples of edge computing processes discussed in the systems?} 

\subsection{Layer 4: Data Accumulation}
\label{sec:iot-model-layer4}

The data that is generated by the edge devices is propagated through the system, and eventually reaches the central server. Up to this point, the model is event driven. However, most applications cannot make use of the data at the rate it is generated \cite{10.5555/3161403}. The Data Accumulation layer details how the system captures the data and stores it, so applications can make use of it when needed, thus transiting from event to query-based processing. \bigskip

As the devices continuously generate data, the system will require more and more resources in order to process and store all of this information, raising some concerns regarding how the data can be managed. In \cite{Doukas2012}, the authors propose the usage of cloud platforms as a solution to these problems. This is made possible due to the elasticity in allocating, swiftly and inexpensively, computing and storage resources on-demand, adjusting itself to the needs of each application. In general, three distinct types of cloud services can be identified: 

\begin{itemize}
    \item \textbf{Infrastructure as Service (IaaS)}: Provides control over the remote machine (composed of virtual or dedicated hardware), operative system and middleware. This approach gives system designers the highest level of flexibility over the infrastructure, but requires more maintenance.
    \item \textbf{Platform as a Service (PaaS)}: Provides a simple framework for developing applications, where the service provider manages the underlying infrastructure issues such as software updates and hardware maintenance. 
    \item \textbf{Software as a Service (SaaS)}: Provides the finished applications to be used by the end users, in this case health workers, that enable them to work. A simple example is a web-based email service, such as Gmail or Microsoft Outlook. 
\end{itemize}
Figure \ref{fig:differences-between-cloud-services} shows the differences between these cloud offerings and on-premise deployments.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{images/cloud-services.pdf}
    \caption[Differences between the cloud offerings and on-premise solutions.]{ Differences between the cloud offerings and on-premise solutions. Source: \cite{RedHat2021}}
    \label{fig:differences-between-cloud-services}
\end{figure}

% \todo[inline]{To-do: Should homomorphic encryption methods be discussed? Discuss what is Hadoop? What are the 5 Vs of Big Data?}

Nonetheless, security and privacy remain as key concerns for the implementation of cloud-based solutions. The information must remain accessible to authorized parties such as healthcare providers, but the patients health data has to be kept private. To solve this, there are two commonly adopted features in the literature: access control policies and data encryption \cite{Baker2017}. Access control policies define who can access the data, by authenticating them (validating the identity of the user) and by authorizing them (ensuring that the user has permissions to perform a given operation). Data encryption ensures that, even if the data is leaked, it is still unreadable to third parties, and therefore sensitive information remains secure and private. \bigskip

Regarding storage solutions, most research works use traditional relational databases (RDBMS) as the means of storing data \cite{Fuhrer2006, Wu2020, Catarinucci2015, Adame2018}. These are often referred to simply \acs{SQL} or \acf{SQL} databases, which is the language used to interact with the database.

However, since the data in \acs{IoT} can very heterogenous and unstructured, the authors of \cite{Subahi2019} propose using NoSQL databases. NoSQL or ``not only SQL'' describes a class of database systems that can support -- and are more optimized for -- storing semi-structured and unstructured data. NoSQL data stores typically outperform SQL databases as the data increases in volume \cite{Xu2014}. Table \ref{tab:comparsion-databasetech} illustrates the differences between these two technologies. 

\renewcommand{\arraystretch}{2}
\begin{table}[H]
    \centering
    \caption{Comparison between SQL and NoSQL database technologies.}
    \begin{adjustbox}{width=0.875\columnwidth,center}
    \begin{tabular}{r|l|l}
        %\textbf{Features} 
        & \textbf{SQL}& \textbf{NoSQL}  \\ \hline
        \textbf{Type of database} & Relational & Non-relational \\
        \textbf{Database model} & Table-based database & \makecell{Document-based databases, \\ Key-value stores, graph stores, \\ wide column stores} \\
        \textbf{Data type} & Appropriate for structured data & \makecell{Appropriate for unstructured or \\ semi-structured data} \\ 
        \textbf{Schema} & Strict schema & Dynamic schema \\
        \textbf{Query} & \makecell{Uses Standard Query \\Language (SQL), appropriate for \\ complex query operations} & \makecell{No standard query language}  \\ 
        \textbf{Scalability} & Vertical & Horizontal \\
        \textbf{Performance} & \makecell{Generally lower than \\ NoSQL systems} & Optimized for large datasets \\
    \end{tabular}
    \end{adjustbox}
    \label{tab:comparsion-databasetech}
\end{table} 
\renewcommand{\arraystretch}{1}

\subsection{Layer 5: Data Abstraction}
\label{sec:iot-model-layer5}

%\todo[inline]{To-do: Complete section (develop FHIR section).} 

The previous layer defines how the system captures the information. In some cases, the collection of data may require the development of multiple concurrent storage solutions, each using different technologies, resulting in a very complex environment. The purpose of this layer is to define services that simplify how the applications access the data, to reconcile the different data stores and ensure the information is complete and consistent \cite{Cisco2014}. Applications can then interact with these databases through interfaces exposed by these services, designated \acl{API}s (\acs{API}s). \bigskip 

An \acs{API} is a computing interface that defines a set of rules that ``explain how computers and applications communicate with one another'', acting as an intermediary between these different components \cite{IBMAPI}. It defines which operations can be performed, how to request them, which are the accepted data types, etc. In this case, it decouples applications from the storage solutions, by encapsulating their functionality behind the interface. This ensures the modularity of the system as the applications become independent of whichever technologies are used in the data stores. \bigskip

Understanding what and how information is shared within the healthcare domain is fundamental. As patients continuously circulate through the healthcare ecosystem, their health information must be available, discoverable and understandable to different entities (hospitals, laboratories, pharmacies, etc.). This prompts the digitization of medical files and the development of standards for exchanging these records instantly and securely to authorized parties \cite{HL72019}, which are called \acl{EHR}s (\acs{EHR}s). \acs{EHR}s are the digital equivalent of a patient's paper-chart, containing the patient's full medical history: previous diagnoses, treatment plans, test results, known allergies, among other details. \bigskip

One of the most prominent standards for exchanging \acs{EHR}s is \acf{FHIR}. \acs{FHIR} is a standard developed by Health Level Seven International (HL7), which is a non-profit organization involved in the development of international healthcare informatics for over 20 years. \acs{FHIR} builds upon previous data format standards like HL7 v2 and HL7 v3, and is becoming widely adopted within the healthcare industry \cite{Peng2019}. This standard defines a lightweight RESTful framework using common data formats, like JSON and XML, so it can be readily integrated into lightweight web services, thus underlining its suitability for web-based platforms \cite{Gruendner2019}.

% \todo[inline]{To-do: If time allows it, add 2 examples of articles where APIs implemented.} 

\subsection{Layer 6: Application}
\label{sec:iot-model-layer6}

The sixth layer corresponds to the application layer, where the system ingests the captured data, analyzes it and delivers the value to the end users. Users can then interact with the system through an \acf{UI}, which provide different functionalities depending on the application. Some may show simple reports regarding the collected data \cite{Doukas2012, Wu2020}, and others may allow users to monitor and have greater control over the different components of the system. \bigskip

As seen in an earlier section, Table \ref{tab:layer1-sensors} shows what kind of information is generally acquired in \acs{IoT} healthcare applications. Using artificial intelligence, it is also possible to correlate all of this information to guide the clinical decisions from healthcare providers \cite{Gruendner2019, Wagholikar2017, Raposo2021}. \bigskip
\subsection{Layer 7: Collaboration and Processes}
\label{sec:iot-model-layer7}

% Não removia, uma secção curta e concisa está OK porque não é tão relevante para o trabalho como as outras.
% Podes mencionar, de forma conceptual apenas (não estou a ver nesta fase como operacionalizar no projecto ainda, nem vala a pena especular) o seguinte:
% "Analyze opportunities to improve the efficiency and effectiveness of the processes."
% "Identification of the goals, deliverables, activities, patterns of collaboration, techniques, actions, and technologies associated with each process."
% Ver:
% https://ieeexplore.ieee.org/document/6148656


The information that is created by the \acs{IoT} systems yields little value unless it prompts action, which requires integrating people and business processes (seventh layer). The purpose of these systems is to empower people to work better and more efficiently by providing valuable insight at the right time. To do this, people must be able to communicate and collaborate, which often requires multiple steps and transcends multiple applications \cite{Cisco2014}. However, this component of the system is beyond the scope of this work and thus it is not discussed further.

\section{Survey on \acs{IoT} Applications for Healthcare}
\label{sec:sim-approaches}
\input{state_of_art-sysrev}

\paragraph{} Table \ref{tab:comparsion-articles} summarizes the key properties of the previously discussed solutions.

\begin{landscape}
\renewcommand{\arraystretch}{2}
\begin{table}[h]
    \centering
    \caption{Comparison between different pervasive healthcare applications.}
    \begin{adjustbox}{width=\columnwidth,center}
    \begin{tabular}{l|l|l|l|l|l|l}
      \textbf{References} & \makecell{\textbf{Measured} \textbf{Signals}} & \makecell{\textbf{Networking} \textbf{Protocols}}& \makecell{\textbf{Data} \textbf{Storage}} & \makecell{\textbf{e-Health} \textbf{Standards}} & \makecell{\textbf{Application} \\ \textbf{Features}} & \textbf{Security Features} \\ \hline
        Fuhrer et al. \cite{Fuhrer2006} & N/A & \makecell{EPC/RFID,\\ Wi-Fi} & MySQL & None & \makecell{RTLS}& \makecell{Unspecified Storage \\Encryption} \\ \hdashline
        Adame et al. \cite{Adame2018} & \makecell{Temperature, \\Heart Rate,\\ Accelerometer} & \makecell{EPC/RFID,\\ Wi-Fi} & MySQL & None & \makecell{RTLS, \\ Fall Detection,\\ Vital signs\\ monitoring}& \makecell{AES-128, WPA-Personal} \\ \hdashline
        %\cite{Catarinucci2015} & \makecell{Temperature, \\ \acs{ECG}, Accelerometer,\\  Barometric Pressure,\\  Ambient Light} & \makecell{EPC/RFID, 6LowPAN,\\ CoAP} & MySQL & None & RTLS & ? \\
        Wu et al. \cite{Wu2020} & \makecell{Temperature, \\Heart Rate,\\ Accelerometer} & \makecell{BLE, Wi-Fi, \\ MQTT} & MySQL & None & \makecell{RTLS, \\ Fall Detection,\\ Vital signs\\ monitoring}& \makecell{AES-128} \\ \hdashline
        Doukas et al. \cite{Doukas2012} & \makecell{Temperature, \\Heart Rate,\\ Accelerometer, \\$CO_2$ Sensor} & \makecell{\acs{BLE}, Wi-Fi, GPRS/3G \\ HTTP} & MySQL & None & \makecell{Fall Detection, \\ Vital signs \\ monitoring} & AES \\ \hdashline
        Raposo et al. \cite{Raposo2021} & \makecell{Temperature, \\Heart Rate,\\ Pulse Oximetry, \\ Respiration Rate } & \makecell{\acs{BLE}, Wi-Fi} & Unknown & None & \makecell{Fall Detection,\\ Vital signs\\ monitoring, \\ Clinical decision\\  support } & Unknown \\ 
        %\cite{} & & & & & &  \\
      \end{tabular}
    \end{adjustbox}
    \label{tab:comparsion-articles}
\end{table} 
\renewcommand{\arraystretch}{1}
\end{landscape}
\clearpage
\subsection{Weaknesses of literature}
\label{sec:weaknesses}

% Apenas identificas o problema da Interoperabilidade e Standards?
% Pensa tb nas questões de segurança e escalabilidade. 
% Pode não ser uma fraqueza/desafio comum a *todos* os trabalhos na literatura mas ser algo q nem sempre é bem resolvido.

In the literature, many solutions secure communications between the devices using standard encryption algorithms like Advanced Encryption Standard (AES) \cite{Adame2018, Wu2020, Doukas2012}. However, very few discuss authentication and authorization processes \cite{Doukas2012, Gope2016}. To ensure that no data is leaked to malicious authors, the networking protocols used must ensure these \textbf{security} properties. \bigskip

Several web services currently use \acf{TLS} \cite{tls}. This protocol ensures integrity, confidentiality and authentication as it combines public key cryptography to validate the identity of the communicating parties, symmetric-key algorithms to encrypt the transmissions and message integrity checks to ensure the transmissions are not tampered during transport. These properties make this protocol invaluable for secure communications over the web, and thus should be an integral component of \acs{IoT} networks. Moreover, access control needs to be considered. Systems are composed by many devices, which may have different levels of access level for each device. For example, limiting access to certain topics in \acs{MQTT}, so that devices can only subscribe and publish messages in specific topics.      

\paragraph{} Despite recent efforts, \textbf{interoperability} is still an issue for \acs{IoT} systems. Due to the lack of clear and concise industry standards and regulations, many manufacturers develop their own proprietary data formats and communication protocols, which hampers the integration of new resources since solutions are designed within closed ecosystems \cite{Rubi2019}. \bigskip

Fortunately, there are several international initiatives to promote the use of \acs{IoT} in health in a standardized way, such as HIMSS (Healthcare Information and Management Systems Society) and the Personal Connected Health Alliance (PCHAlliance). PCHAlliance, for example, advocates the adoption of the Continua Design Guidelines (CDG), which facilitates the integration of personal health devices into health systems. These guidelines have been recognized by ITU (International Telecommunication Union) and the European Commission and are adopted by countries such as Denmark, Norway and the USA, among others \cite{PersonalConnectedHealthAlliance2017}. These guidelines promote a series of e-health standards like \acs{FHIR} which facilitate the exchange of information between systems, in order to ensure that the implementations become truly interoperable.

\clearpage
\section{Statement of Contributions}
\label{sec:statement_of_contrib}
%\section{System Architecture}

\paragraph{} In the scope of the \acs{WoW} R\&D project, wearable devices, designated ``Biostickers'', have been developed to collect physiological patient signals using the \acs{BLE} networking stack. As an alternative, the project also studied the possibility of using of \acs{RFID} for the networking stack, in an effort of creating battery-less wearable devices. However, this has shown to be unfeasible due to strict energy consumption and energy transfer requirements that could not be met during development. 

\paragraph{} Having this in mind, and in the context of this dissertation work, a novel fully modular \acs{IoT} infrastructure is proposed, making use the \acs{FHIR} standard in order to fully integrate the data into an existing and widely used \acs{HIS} -- GlobalCare\footnote{GlobalCare by Glintt: \url{https://globalcare.glintt.com/}} by Glintt - Healthcare Solutions, S.A. 

\paragraph{} From a hardware perspective, the \acs{IoT} system is composed of 3 different components, as seen in Figure \ref{fig:wow-architecture}:
\begin{itemize}
    \item the \textit{Biosticker} (and the Oximeter), that acquire the patient's physiological signals;
    \item the \textit{Smart box}, which acts as a central node of the \acs{WBAN} and aggregates the data, communicating it to the gateway{\color{blue} via Wi-Fi};
    \item and finally, the \textit{Smart Gateway}, which serves as a fog server in order to mitigate latency and other computing issues and acts as the gateway to the \acs{HIS}, by communicating with the ``Interoperability'' \acs{FHIR} layer on the \acs{HIS}.
\end{itemize}

\paragraph{} As the goal of the project is the deployment of the system in an hospital, Centro Hospitalar e Universitário de Coimbra (CHUC), each \textit{Smart box} is coupled with a hospital bed, which is referred as a \textit{SmartBed}.

\clearpage
\begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{images/architecture-color.drawio.pdf}
    \caption[System architecture of the \acs{WoW} project.]{System architecture of the \acs{WoW} project. In this work, the details of implementation of the \textit{Smart Gateway} components are discussed, as well as contributions to the \textit{Smart box} development.}
    \label{fig:wow-architecture}
\end{figure}

For the work developed throughout the dissertation, the following contributions are proposed:

\begin{itemize}
    \item Development and deployment of the \textit{Smart boxes} embedded in hospital beds for data acquisition from \textit{Biostickers} attached to patients’ skin, namely:
    \begin{itemize}
        \item Hardware evaluation of 2 different \acs{IoT} kits (Raspberry Pi and Udoo Bolt).
        \item Evaluation of different \acs{BLE} adapters for data acquisition.
        %\item Selection of hardware components and assembly of Smart box prototype;
    \end{itemize}
    \item Design and {\color{blue} implementation} of data integration pipelines using \acs{MQTT} and management of the multiple \textit{Smart boxes} in the \textit{Smart Gateway};
    \item {\color{blue} Usage} of a \acs{FHIR} \acs{API} layer to integrate the proposed system in the GlobalCare \acs{HIS}.
    \item Evaluation of the performance of the proposed system on an hospital trial and through controlled lab tests within the \acs{WoW} project.
    % 
    %\item Evaluate the need for data analysis to extract relevant user profiles/anomalies for long-term biomonitoring data of multiple anonymous users.
\end{itemize}

\section{Summary}
In this chapter, the importance of \acs{IoT} systems is discussed, how these systems are composed and how these can bring value to healthcare providers. After analyzing different relevant systems proposed previously in the literature, a set of criteria was defined to guide the development of our own implementation.

\bigskip

The next chapter begins with the evaluation of the different \acs{IoT} kits for the \textit{Smart Bed} hardware, and afterwards, an evaluation of different \acs{BLE} adapters for patient data acquisition to implement secure communications between the \textit{Biostickers} and the \textit{Smart boxes}. 

% - Hardware evaluation for edge nodes which integrate electronic wireless patches that gather patient's physiological signals;
% - Integrating IoT system in an existing healthcare information system (Glintt GlobalCare software) through an FHIR API layer;
% - Evaluation of the performance of the proposed system through a testbed and a real healthcare scenario;

% In the context of the WoW project, a preliminary study will be performed, by analyzing 24 hours of data from 3 volunteers who are using a speciﬁc drug (i.e.! paracetamol) in order to illustrate the effect of the drug intake on various parameters, including temperature, emotions, heart rate, blood oxygen, and respiration.

% Se fizer sentido, na dissertação podes ter um capitulo de "Technological Background", que faz um overview às ferramentas de sotware e ao próprio hardware utilizado no projecto. (to be discussed later)

\bigskip